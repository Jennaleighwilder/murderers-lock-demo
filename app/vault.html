<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vault - Lock/Unlock | The Murderer's Lock</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Playfair+Display:wght@700;900&family=JetBrains+Mono:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/vault.css">
</head>
<body>
  <div class="neon-bg"></div>
  <div class="container">
    <a href="dashboard.html" class="back-link">â† Back to Dashboard</a>

    <div class="vault-header">
      <div class="vault-icon">ğŸ”’</div>
      <div style="flex:1;">
        <h1 class="vault-title" id="vault-name">â€”</h1>
        <div class="vault-id" id="vault-id">â€”</div>
      </div>
      <div id="security-badge-container" style="display:none;"></div>
    </div>

    <div class="vault-card locked-view" id="vault-view">
      <div class="locked-content">
        <h3 style="margin-bottom: 24px; font-size: 20px;">Unlock Vault</h3>
        <p style="color: var(--text-silver); margin-bottom: 24px;">Enter your vault password to decrypt and access your secrets. <span style="color:var(--text-gray);font-size:12px;">Ctrl+Enter to unlock</span></p>
        <form id="unlock-form">
          <div class="form-group">
            <label class="form-label">Vault Password</label>
            <input type="password" class="form-input" id="unlock-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
          </div>
          <div class="form-group" id="2fa-code-group" style="display: none;">
            <label class="form-label">Authenticator Code (2FA)</label>
            <input type="text" inputmode="numeric" pattern="[0-9]*" class="form-input" id="unlock-totp-code" placeholder="000000" maxlength="6" style="width: 140px; font-family: monospace; letter-spacing: 0.3em;">
          </div>
          <button type="submit" class="btn btn-primary">ğŸ”“ Unlock Vault</button>
          <p class="error-msg" id="unlock-error"></p>
        </form>
        <a href="recovery.html?id=" id="recovery-link" class="recovery-link">Lost password? Use Shamir recovery â†’</a>
        <p id="vault-integrity" style="font-size: 11px; color: var(--text-gray); margin-top: 20px;"></p>
      </div>

      <div class="unlocked-content">
        <div id="key-profile-container" style="display:none; margin-bottom:24px; padding:20px; background:rgba(0,0,0,0.4); border-radius:12px; border:1px solid rgba(57,255,20,0.3);">
          <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;">
            <span style="font-size:12px; color:var(--neon-lime); text-transform:uppercase; letter-spacing:0.1em;">âœ“ 33 Gates Aligned â€” Key Profile</span>
            <button type="button" id="key-profile-rotate" class="btn btn-secondary" style="padding:8px 16px; font-size:12px;">â†» Rotate</button>
          </div>
          <div id="key-profile-svg"></div>
        </div>
        <h3 style="margin-bottom: 24px; font-size: 20px;">Vault Contents</h3>
        <div class="form-group">
          <label class="form-label">Secrets (encrypted at rest) <span style="color:var(--text-gray);font-weight:400;">â€” Ctrl+Enter to save, Ctrl+L to lock</span></label>
          <textarea class="secrets-area form-input" id="secrets-content" placeholder="site.com | username | password (one per line)"></textarea>
          <button type="button" class="btn btn-secondary" id="copy-password-btn" style="margin-top:8px;font-size:12px;padding:8px 16px;">ğŸ“‹ Copy from line (secure, clears in 30s)</button>
        </div>
        <button type="button" class="btn btn-primary" id="save-secrets">Save Changes</button>
        <button type="button" class="btn btn-secondary" id="lock-vault">ğŸ”’ Lock Vault</button>
        <div id="recovered-banner" style="display: none; margin-top: 20px; padding: 16px; background: rgba(57, 255, 20, 0.1); border: 2px solid var(--neon-lime); border-radius: 12px;">
          <p style="color: var(--neon-lime); font-size: 13px; margin-bottom: 12px;">Recovered vault â€” set a password to enable save:</p>
          <input type="password" id="recovered-password" placeholder="New password (min 12 chars)" style="width: 100%; padding: 12px; margin-bottom: 8px; background: rgba(0,0,0,0.5); border: 2px solid var(--neon-lime); border-radius: 8px; color: white;">
          <div id="recovered-password-strength" style="margin-top:8px;"></div>
          <button type="button" class="btn btn-primary" id="set-recovered-password" style="margin: 0;">Set Password & Enable Save</button>
        </div>
        <p class="success-msg" id="save-success">Saved.</p>
        <a href="recovery.html?id=" id="recovery-link-unlocked" class="recovery-link">Set up Shamir recovery keys â†’</a>

        <div class="import-section" style="margin-top:32px;padding-top:24px;border-top:1px solid rgba(0,245,255,0.2);">
          <h4 style="color:var(--neon-cyan);font-size:14px;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:12px;">ğŸ“¥ Import Passwords</h4>
          <p style="color:var(--text-silver);font-size:13px;margin-bottom:12px;">Import from 1Password, Bitwarden, LastPass, Chrome, or generic CSV.</p>
          <input type="file" id="import-file" accept=".csv,.json,.1pif,text/csv,application/json" style="display:none;">
          <button type="button" class="btn btn-primary" id="import-trigger" style="margin-bottom:12px;">Choose File</button>
          <span id="import-loading" style="display:none;margin-left:12px;color:var(--neon-cyan);font-size:12px;">Processing...</span>
          <div id="import-preview" style="display:none;margin-top:12px;padding:16px;background:rgba(0,0,0,0.4);border-radius:12px;border:1px solid rgba(0,245,255,0.2);max-height:200px;overflow-y:auto;font-size:12px;font-family:JetBrains Mono,monospace;"></div>
          <div id="import-actions" style="display:none;margin-top:12px;">
            <button type="button" class="btn btn-primary" id="import-merge">Merge into Vault</button>
            <button type="button" class="btn btn-secondary" id="import-replace">Replace Vault</button>
          </div>
          <p id="import-error" style="color:var(--neon-pink);font-size:12px;margin-top:8px;display:none;"></p>
        </div>

        <div class="audit-log-section" style="margin-top:32px;padding-top:24px;border-top:1px solid rgba(0,245,255,0.2);">
          <h4 style="color:var(--neon-cyan);font-size:14px;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:12px;">ğŸ“‹ Audit Log</h4>
          <p style="color:var(--text-silver);font-size:13px;margin-bottom:12px;">Recent vault access and changes.</p>
          <button type="button" class="btn btn-secondary" id="load-audit-log" style="margin-bottom:12px;">Load Audit Log</button>
          <div id="audit-log-list" style="min-height:40px;padding:16px;background:rgba(0,0,0,0.4);border-radius:12px;border:1px solid rgba(0,245,255,0.2);font-size:12px;font-family:JetBrains Mono,monospace;"></div>
        </div>

        <div class="password-health-section" style="margin-top:32px;padding-top:24px;border-top:1px solid rgba(0,245,255,0.2);">
          <h4 style="color:var(--neon-cyan);font-size:14px;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:12px;">ğŸ” Password Health</h4>
          <p style="color:var(--text-silver);font-size:13px;margin-bottom:12px;">Check weak, reused, and breached passwords.</p>
          <button type="button" class="btn btn-secondary" id="run-health-check" style="margin-bottom:12px;">Run Health Check</button>
          <div id="password-health-report" style="min-height:60px;padding:16px;background:rgba(0,0,0,0.4);border-radius:12px;border:1px solid rgba(0,245,255,0.2);"></div>
        </div>

        <div class="kill-switch-section">
          <h4>âš ï¸ Kill Switch</h4>
          <p style="color: var(--text-silver); font-size: 13px; margin-bottom: 16px;">Play the 5-part harmony (C-E-G-C-G) to permanently destroy this vault. Irreversible.</p>
          <div class="tone-buttons" id="tone-buttons">
            <button type="button" class="tone-btn" data-tone="0" data-freq="261.63">C</button>
            <button type="button" class="tone-btn" data-tone="1" data-freq="329.63">E</button>
            <button type="button" class="tone-btn" data-tone="2" data-freq="392.00">G</button>
            <button type="button" class="tone-btn" data-tone="3" data-freq="523.25">Câ€²</button>
            <button type="button" class="tone-btn" data-tone="4" data-freq="392.00">G</button>
          </div>
          <p id="kill-sequence-status" style="font-size: 12px; color: var(--text-gray);">Sequence: â€”</p>
          <button type="button" class="btn btn-danger" id="destroy-vault-btn" style="margin-top: 16px; display: none;">Destroy Vault</button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/validate.js"></script>
  <script src="js/device-keys.js"></script>
  <script src="js/password-strength-meter.js"></script>
  <script src="js/password-health.js"></script>
  <script src="js/security-badge.js"></script>
  <script src="js/secure-copy.js"></script>
  <script src="js/simplewebauthn-browser.js"></script>
  <script src="js/secure-memory.js"></script>
  <script src="js/proof-of-work-visualizer.js"></script>
  <script src="js/key-profile-display.js"></script>
  <script src="js/vault.js"></script>
</body>
</html>
