<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Account Settings | The Murderer's Lock</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Playfair+Display:wght@700;900&family=JetBrains+Mono:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/settings.css">
</head>
<body>
  <div class="neon-bg"></div>
  <div class="container">
    <a href="dashboard.html" class="back-link">← Back to Dashboard</a>
    <h1 class="page-title">Account Settings</h1>
    <p class="page-subtitle">Manage your profile and security preferences.</p>

    <div class="settings-card">
      <h3>Profile</h3>
      <form id="profile-form">
        <div class="form-group">
          <label class="form-label">Display Name</label>
          <input type="text" class="form-input" id="display-name" placeholder="Your name" maxlength="64">
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="email" placeholder="you@example.com" disabled>
        </div>
        <button type="submit" class="btn btn-primary">Save Profile</button>
        <p class="success-msg" id="profile-success">Profile saved.</p>
      </form>
      <div class="account-info" id="account-info">Account created: —</div>
    </div>

    <div class="settings-card">
      <h3>Change Password</h3>
      <form id="password-form">
        <div class="form-group">
          <label class="form-label">Current Password</label>
          <input type="password" class="form-input" id="current-password" placeholder="••••••••" required>
        </div>
        <div class="form-group">
          <label class="form-label">New Password</label>
          <input type="password" class="form-input" id="new-password" placeholder="Min 12 characters" required minlength="12">
          <div id="new-password-strength" style="margin-top:8px;"></div>
        </div>
        <div class="form-group">
          <label class="form-label">Confirm New Password</label>
          <input type="password" class="form-input" id="confirm-password" placeholder="••••••••" required>
        </div>
        <button type="submit" class="btn btn-primary">Update Password</button>
        <p class="error-msg" id="password-error"></p>
        <p class="success-msg" id="password-success">Password updated.</p>
      </form>
    </div>

    <div class="settings-card" id="2fa-settings-card">
      <h3>Two-Factor Authentication (2FA)</h3>
      <p style="color: var(--text-silver); margin-bottom: 20px; font-size: 14px;">Add an extra layer of security. Use Google Authenticator, Authy, or any TOTP app.</p>
      <div id="2fa-status" style="margin-bottom: 16px; padding: 12px; border-radius: 8px; font-size: 14px;"></div>
      <div id="2fa-setup-form" style="display: none;">
        <p style="color: var(--neon-lime); margin-bottom: 16px; font-size: 13px;">Scan the QR code with your authenticator app, then enter the 6-digit code to verify.</p>
        <div id="2fa-qr-container" style="margin-bottom: 16px;"></div>
        <div class="form-group">
          <label class="form-label">6-digit code</label>
          <input type="text" inputmode="numeric" pattern="[0-9]*" class="form-input" id="2fa-verify-code" placeholder="000000" maxlength="6" style="width: 120px; font-family: monospace; letter-spacing: 0.3em;">
        </div>
        <button type="button" class="btn btn-primary" id="2fa-verify-btn">Verify & Enable</button>
        <button type="button" class="btn btn-secondary" id="2fa-setup-cancel" style="margin-left: 12px;">Cancel</button>
      </div>
      <div id="2fa-actions">
        <button type="button" class="btn btn-primary" id="2fa-enable-btn" style="display: none;">Enable 2FA</button>
        <button type="button" class="btn btn-secondary" id="2fa-disable-btn" style="display: none;">Disable 2FA</button>
      </div>
      <p class="success-msg" id="2fa-success" style="display: none;">2FA updated.</p>
    </div>

    <div class="settings-card" id="webauthn-settings-card">
      <h3>Security Key (WebAuthn / Passkey)</h3>
      <p style="color: var(--text-silver); margin-bottom: 20px; font-size: 14px;">Use Face ID, Touch ID, or a hardware security key to unlock vaults.</p>
      <div id="webauthn-status" style="margin-bottom: 16px; padding: 12px; border-radius: 8px; font-size: 14px;"></div>
      <button type="button" class="btn btn-primary" id="webauthn-register-btn" style="display: none;">Add Security Key</button>
      <p class="success-msg" id="webauthn-success" style="display: none;">Security key added.</p>
    </div>

    <div class="settings-card" id="pin-settings-card">
      <h3>Shard Protection PIN</h3>
      <p style="color: var(--text-silver); margin-bottom: 20px; font-size: 14px;">Encrypt recovery shards with a PIN. If your device is stolen, shards are useless without the PIN.</p>
      <div id="pin-status" style="margin-bottom: 16px; padding: 12px; border-radius: 8px; font-size: 14px;"></div>
      <div id="pin-change-form" style="display: none;">
        <div class="form-group">
          <label class="form-label">Current PIN</label>
          <input type="password" inputmode="numeric" class="form-input" id="pin-current" placeholder="••••" maxlength="12">
        </div>
        <div class="form-group">
          <label class="form-label">New PIN (4+ digits)</label>
          <input type="password" inputmode="numeric" class="form-input" id="pin-new" placeholder="••••" maxlength="12">
        </div>
        <div class="form-group">
          <label class="form-label">Confirm New PIN</label>
          <input type="password" inputmode="numeric" class="form-input" id="pin-confirm" placeholder="••••" maxlength="12">
        </div>
        <button type="button" class="btn btn-primary" id="pin-change-btn">Change PIN</button>
        <button type="button" class="btn btn-secondary" id="pin-change-cancel" style="margin-left: 12px;">Cancel</button>
      </div>
      <div id="pin-actions">
        <button type="button" class="btn btn-primary" id="pin-set-btn" style="display: none;">Set PIN</button>
        <button type="button" class="btn btn-secondary" id="pin-change-show" style="display: none;">Change PIN</button>
        <button type="button" class="btn btn-secondary" id="pin-protect-all" style="display: none; margin-top: 12px;">Protect all vaults</button>
      </div>
      <p class="success-msg" id="pin-success" style="display: none;">PIN updated.</p>
    </div>

    <div class="settings-card">
      <h3>Dead Man's Switch</h3>
      <p style="color: var(--text-silver); margin-bottom: 20px; font-size: 14px;">If you don't check in by your interval, emergency contacts receive vault access instructions. 5-day grace period.</p>
      <a href="dms.html" class="btn btn-primary">Configure Dead Man's Switch</a>
    </div>

    <div class="settings-card danger-zone">
      <h3 style="color: var(--neon-orange);">Danger Zone</h3>
      <p style="color: var(--text-silver); margin-bottom: 20px; font-size: 14px;">Permanently delete your account and all vault data. This cannot be undone.</p>
      <button type="button" class="btn btn-danger" id="delete-account">Delete Account</button>
    </div>
  </div>

  <script src="js/validate.js"></script>
  <script src="js/password-strength-meter.js"></script>
  <script src="js/simplewebauthn-browser.js"></script>
  <script src="js/shard-protection.js"></script>
  <script src="js/settings.js"></script>
</body>
</html>