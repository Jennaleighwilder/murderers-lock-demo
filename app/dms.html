<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dead Man's Switch | The Murderer's Lock</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Playfair+Display:wght@700;900&family=JetBrains+Mono:wght@600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-void: #000000;
      --neon-pink: #FF10F0;
      --neon-cyan: #00F5FF;
      --neon-purple: #B624FF;
      --neon-gold: #FFD700;
      --neon-lime: #39FF14;
      --neon-orange: #FF6600;
      --oil-slick: linear-gradient(135deg, #FF10F0 0%, #B624FF 15%, #00F5FF 30%, #39FF14 45%, #FFD700 60%, #FF6600 75%, #FF10F0 100%);
      --text-white: #FFFFFF;
      --text-silver: #E0E0E0;
      --text-gray: #808080;
    }
    body { font-family: 'Space Grotesk', sans-serif; background: var(--bg-void); color: var(--text-white); min-height: 100vh; overflow-x: hidden; }
    .neon-bg { position: fixed; inset: 0; background: radial-gradient(ellipse at 20% 30%, rgba(255, 16, 240, 0.15) 0%, transparent 50%), radial-gradient(ellipse at 80% 70%, rgba(0, 245, 255, 0.15) 0%, transparent 50%); pointer-events: none; z-index: 0; }
    .container { max-width: 720px; margin: 0 auto; padding: 32px 24px; position: relative; z-index: 1; }
    .back-link { color: var(--neon-cyan); text-decoration: none; font-weight: 600; margin-bottom: 24px; display: inline-block; }
    .back-link:hover { opacity: 0.8; }
    .page-title { font-family: 'Playfair Display', serif; font-size: 36px; font-weight: 900; margin-bottom: 8px; background: var(--oil-slick); background-size: 400% 400%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .page-subtitle { color: var(--text-silver); font-size: 14px; margin-bottom: 40px; line-height: 1.6; }
    .dms-card { background: rgba(18, 18, 26, 0.8); backdrop-filter: blur(20px); border: 2px solid rgba(255, 16, 240, 0.2); border-radius: 24px; padding: 40px; margin-bottom: 24px; }
    .dms-card:hover { border-color: rgba(0, 245, 255, 0.4); box-shadow: 0 0 40px rgba(0, 245, 255, 0.2); }
    .dms-card h3 { font-size: 18px; margin-bottom: 20px; color: var(--neon-cyan); text-transform: uppercase; letter-spacing: 0.1em; }
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 10px; text-transform: uppercase; letter-spacing: 0.15em; color: var(--neon-cyan); }
    .form-input { width: 100%; padding: 16px 20px; background: rgba(0, 0, 0, 0.5); border: 2px solid rgba(255, 16, 240, 0.3); border-radius: 12px; color: var(--text-white); font-family: 'Space Grotesk', sans-serif; font-size: 16px; }
    .form-input:focus { outline: none; border-color: var(--neon-cyan); }
    .form-select { width: 100%; padding: 16px 20px; background: rgba(0, 0, 0, 0.5); border: 2px solid rgba(255, 16, 240, 0.3); border-radius: 12px; color: var(--text-white); font-family: 'Space Grotesk', sans-serif; font-size: 16px; cursor: pointer; }
    .btn { padding: 14px 28px; border: 2px solid; border-radius: 12px; font-family: 'Space Grotesk', sans-serif; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; transition: all 0.3s; }
    .btn-primary { background: rgba(0, 245, 255, 0.1); border-color: var(--neon-cyan); color: var(--neon-cyan); }
    .btn-primary:hover { background: rgba(0, 245, 255, 0.2); transform: translateY(-2px); }
    .btn-secondary { background: transparent; border-color: var(--neon-pink); color: var(--neon-pink); margin-right: 12px; }
    .btn-secondary:hover { background: rgba(255, 16, 240, 0.1); transform: translateY(-2px); }
    .btn-success { background: rgba(57, 255, 20, 0.1); border-color: var(--neon-lime); color: var(--neon-lime); }
    .btn-success:hover { background: rgba(57, 255, 20, 0.2); transform: translateY(-2px); }
    .btn-sm { padding: 8px 16px; font-size: 12px; }
    .contact-item { display: flex; align-items: center; gap: 16px; padding: 16px; background: rgba(0,0,0,0.4); border-radius: 12px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.1); }
    .contact-item span { flex: 1; }
    .contact-item .email { font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--text-gray); }
    .status-badge { display: inline-block; padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 700; margin-bottom: 20px; }
    .status-ok { background: rgba(57, 255, 20, 0.2); border: 2px solid var(--neon-lime); color: var(--neon-lime); }
    .status-warning { background: rgba(255, 215, 0, 0.2); border: 2px solid var(--neon-gold); color: var(--neon-gold); }
    .status-overdue { background: rgba(255, 102, 0, 0.2); border: 2px solid var(--neon-orange); color: var(--neon-orange); }
    .info-box { font-size: 13px; color: var(--text-silver); padding: 16px; background: rgba(0,0,0,0.3); border-radius: 12px; margin-top: 20px; line-height: 1.6; border-left: 4px solid var(--neon-purple); }
  </style>
</head>
<body>
  <div class="neon-bg"></div>
  <div class="container">
    <a href="dashboard.html" class="back-link">← Back to Dashboard</a>
    <h1 class="page-title">Dead Man's Switch</h1>
    <p class="page-subtitle">If you don't check in within your interval, your emergency contacts will receive instructions to access your vaults. 5-day grace period with escalating alerts before transfer.</p>

    <div class="dms-card">
      <h3>Check-In Status</h3>
      <div id="status-badge" class="status-badge status-ok">—</div>
      <p id="status-text" style="color: var(--text-silver); margin-bottom: 20px;">—</p>
      <button type="button" class="btn btn-success" id="checkin-btn">✓ I'm Here — Check In</button>
      <p class="success-msg" id="checkin-success" style="color: var(--neon-lime); margin-top: 12px; display: none;">Check-in recorded.</p>
    </div>

    <div class="dms-card">
      <h3>Configuration</h3>
      <form id="dms-form">
        <div class="form-group">
          <label class="form-label">Enable Dead Man's Switch</label>
          <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
            <input type="checkbox" id="dms-enabled" style="width: 24px; height: 24px; accent-color: var(--neon-cyan);">
            <span>Active</span>
          </label>
        </div>
        <div class="form-group">
          <label class="form-label">Check-In Interval</label>
          <select class="form-select" id="interval-days">
            <option value="3">Every 3 days</option>
            <option value="7">Every 7 days</option>
            <option value="14">Every 14 days</option>
            <option value="30">Every 30 days</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Grace Period (before contacts notified)</label>
          <select class="form-select" id="grace-days">
            <option value="3">3 days</option>
            <option value="5" selected>5 days</option>
            <option value="7">7 days</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary">Save Configuration</button>
        <p class="success-msg" id="dms-save-success" style="color: var(--neon-lime); margin-top: 12px; display: none;">Saved.</p>
      </form>
    </div>

    <div class="dms-card">
      <h3>Emergency Contacts (Beneficiaries)</h3>
      <p style="color: var(--text-silver); font-size: 13px; margin-bottom: 20px;">These people will receive vault access instructions if you don't check in.</p>
      <div id="contacts-list"></div>
      <div style="margin-top: 20px;">
        <input type="text" class="form-input" id="contact-name" placeholder="Name" style="margin-bottom: 12px;">
        <input type="email" class="form-input" id="contact-email" placeholder="Email" style="margin-bottom: 12px;">
        <input type="text" class="form-input" id="contact-relation" placeholder="Relationship (e.g., spouse, lawyer)" style="margin-bottom: 12px;">
        <button type="button" class="btn btn-primary" id="add-contact">Add Contact</button>
      </div>
      <div class="info-box">
        <strong>Recovery instructions for contacts:</strong> Each contact will receive an email with your vault IDs and instructions to use 2 of 3 Shamir shards (which you should store with them or in your will) to recover access.
      </div>
    </div>
  </div>

  <script>
    const DMS_KEY = 'vault_manager_dms';

    function getDMS() {
      return JSON.parse(localStorage.getItem(DMS_KEY) || '{}');
    }

    function saveDMS(d) {
      localStorage.setItem(DMS_KEY, JSON.stringify(d));
    }

    const user = sessionStorage.getItem('vault_user');
    if (!user) window.location.href = 'index.html';

    function updateStatus() {
      const dms = getDMS();
      const badge = document.getElementById('status-badge');
      const text = document.getElementById('status-text');
      const btn = document.getElementById('checkin-btn');

      if (!dms.enabled) {
        badge.textContent = 'DISABLED';
        badge.className = 'status-badge status-warning';
        text.textContent = 'Enable the Dead Man\'s Switch above to protect your assets.';
        btn.style.display = 'none';
        return;
      }

      const lastCheckIn = dms.lastCheckIn ? new Date(dms.lastCheckIn) : null;
      const intervalDays = dms.intervalDays || 7;
      const graceDays = dms.graceDays || 5;
      const dueDate = lastCheckIn ? new Date(lastCheckIn.getTime() + intervalDays * 24 * 60 * 60 * 1000) : new Date();
      const graceEnd = new Date(dueDate.getTime() + graceDays * 24 * 60 * 60 * 1000);
      const now = new Date();

      if (!lastCheckIn) {
        badge.textContent = 'NEEDS FIRST CHECK-IN';
        badge.className = 'status-badge status-warning';
        text.textContent = 'Check in now to start your interval.';
        btn.style.display = 'block';
        return;
      }

      if (now > graceEnd) {
        badge.textContent = 'OVERDUE — CONTACTS NOTIFIED';
        badge.className = 'status-badge status-overdue';
        text.textContent = `You missed check-in by ${graceDays} days. In production, your ${(dms.contacts || []).length} contact(s) would have received access instructions. Check in now to reset.`;
        btn.style.display = 'block';
      } else if (now > dueDate) {
        const daysLeft = Math.ceil((graceEnd - now) / (24 * 60 * 60 * 1000));
        badge.textContent = 'GRACE PERIOD';
        badge.className = 'status-badge status-warning';
        text.textContent = `Check-in overdue. ${daysLeft} day(s) until contacts are notified. Check in now to reset.`;
        btn.style.display = 'block';
      } else {
        const daysLeft = Math.ceil((dueDate - now) / (24 * 60 * 60 * 1000));
        badge.textContent = 'ALL GOOD';
        badge.className = 'status-badge status-ok';
        text.textContent = `Next check-in due in ${daysLeft} day(s) (by ${dueDate.toLocaleDateString()}).`;
        btn.style.display = 'block';
      }
    }

    function renderContacts() {
      const dms = getDMS();
      const contacts = dms.contacts || [];
      const list = document.getElementById('contacts-list');
      list.innerHTML = '';

      if (contacts.length === 0) {
        list.innerHTML = '<p style="color: var(--text-gray); font-size: 14px;">No contacts yet. Add at least one.</p>';
        return;
      }

      contacts.forEach((c, i) => {
        const div = document.createElement('div');
        div.className = 'contact-item';
        div.innerHTML = `
          <span>
            <strong>${escapeHtml(c.name)}</strong>
            <div class="email">${escapeHtml(c.email)}</div>
            ${c.relationship ? `<div style="font-size: 11px; color: var(--text-gray);">${escapeHtml(c.relationship)}</div>` : ''}
          </span>
          <button type="button" class="btn btn-secondary btn-sm" data-index="${i}">Remove</button>
        `;
        div.querySelector('button').addEventListener('click', () => {
          const d = getDMS();
          d.contacts = (d.contacts || []).filter((_, j) => j !== i);
          saveDMS(d);
          renderContacts();
        });
        list.appendChild(div);
      });
    }

    function escapeHtml(s) {
      const div = document.createElement('div');
      div.textContent = s || '';
      return div.innerHTML;
    }

    document.getElementById('checkin-btn').addEventListener('click', () => {
      const dms = getDMS();
      dms.lastCheckIn = new Date().toISOString();
      saveDMS(dms);
      document.getElementById('checkin-success').style.display = 'block';
      setTimeout(() => document.getElementById('checkin-success').style.display = 'none', 2000);
      updateStatus();
    });

    document.getElementById('dms-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const dms = getDMS();
      dms.enabled = document.getElementById('dms-enabled').checked;
      dms.intervalDays = parseInt(document.getElementById('interval-days').value, 10);
      dms.graceDays = parseInt(document.getElementById('grace-days').value, 10);
      saveDMS(dms);
      document.getElementById('dms-save-success').style.display = 'block';
      setTimeout(() => document.getElementById('dms-save-success').style.display = 'none', 2000);
      updateStatus();
    });

    document.getElementById('add-contact').addEventListener('click', () => {
      const name = document.getElementById('contact-name').value.trim();
      const email = document.getElementById('contact-email').value.trim();
      const relationship = document.getElementById('contact-relation').value.trim();
      if (!name || !email) {
        alert('Name and email required.');
        return;
      }
      const dms = getDMS();
      dms.contacts = dms.contacts || [];
      dms.contacts.push({ name, email, relationship });
      saveDMS(dms);
      document.getElementById('contact-name').value = '';
      document.getElementById('contact-email').value = '';
      document.getElementById('contact-relation').value = '';
      renderContacts();
    });

    const dms = getDMS();
    document.getElementById('dms-enabled').checked = dms.enabled || false;
    document.getElementById('interval-days').value = dms.intervalDays || 7;
    document.getElementById('grace-days').value = dms.graceDays || 5;

    updateStatus();
    renderContacts();
  </script>
</body>
</html>
